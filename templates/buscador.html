<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Doroti</title>
  <meta name="description" content="Roxy">
  <!-- Cargamos CSS desde la carpeta static -->
  <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400|Work+Sans:300,400,700" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.min.css') }}">
  <link rel="stylesheet" href="https://cdn.linearicons.com/free/1.0.0/icon-font.min.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" 
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" 
        crossorigin="anonymous">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>

  <style>
    /* Puedes agregar estilos propios para ajustar la tabla y demás */
    .mi-tabla {
      width: 100%;
      border-collapse: collapse;
      font-family: 'Lato', sans-serif;
    }
    .mi-tabla th,
    .mi-tabla td {
      border: 1px solid #ccc;
      padding: 5px;
    }
    .mi-tabla th {
      background: #f5f5f5;
    }
    .mi-tabla2 {
      width: 100%;
      border-collapse: collapse;
    }
    .mi-tabla2 td {
      border: 1px solid #ddd;
      padding: 2px 4px;
      font-size: 12px;
    }
    .buscador input[type="text"] {
      padding: 4px 8px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <!-- Área superior del buscador -->
  <div class="buscador d-flex justify-content-end align-items-center" style="padding: 10px;">
    <form method="POST" action="{{ url_for('index') }}" style="margin-right: 15px;">
      <input type="submit" name="agregarcarpeta" value="Inicio" style="text-align:left;" class="btn btn-secondary btn-sm">
    </form>

    <img src="{{ url_for('static', filename='img/Doroti Logo Horizontal.jpg') }}" 
         style="margin-right: 15px; height: 18px;" alt="Logo">
    <input type="text" id="search" placeholder="Buscar..." onkeyup="searchTable()" class="form-control" style="max-width: 200px;">
  </div>

  <!-- Contenedor de la tabla -->
  <!-- ... Código previo del template ... -->

<div id="contenedor" class="container-fluid">
  <table class="mi-tabla">
    <thead>
      <tr>
        <!-- Encabezados de la tabla -->
        <th style="text-align: center; width: 2%;">&nbsp;</th>
        <th style="text-align: center; width: 4%;">Caja</th>
        <th style="text-align: center; width: 4%;">Carpeta</th>
        <th style="text-align: center; width: 15%;">Serie</th>
        <th style="text-align: center; width: 24%;">Título</th>
        <th style="text-align: center; width: 7%;">Fecha Inicial</th>
        <th style="text-align: center; width: 7%;">Fecha Final</th>
        <th style="text-align: center; width: 4%;">Folios</th>
        <th style="text-align: center; width: 4%;">Rotulos</th>
        <th style="text-align: center; width: 4%;">Rotulo</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      {% for fila in carpetas %}
        {% set colorAcordeon = "#e7f4ff" if (fila.Caja % 2 == 0) else "#FFFFFF" %}
        <tr style="background-color: {{ colorAcordeon }};">
          <td style="text-align: center;"><button class="accordion btn btn-sm">v</button></td>
          <td style="text-align: center;">{{ fila.Caja }}</td>
          <td style="text-align: center;">{{ fila.Car2 }}</td>
          <td>
            <b>{{ fila.Serie }}</b><br>
            <span style="line-height: 1; font-size: 12px;">{{ fila.Subs }}</span>
          </td>
          <td>{{ fila.Titulo }}</td>
          <td style="text-align: center;">{{ fila.FInicial }}</td>
          <td style="text-align: center;">{{ fila.FFinal }}</td>
          <td style="text-align: center;"><b>{{ fila.Folios }}</b></td>
          <td style="text-align: center;">
            {% if fila.Estado == 'A' %}
              <form action="{{ url_for('indice') }}" method="post" target="_blank">
                <input type="hidden" name="Caja" value="{{ fila.Caja }}">
                <input type="hidden" name="Car2" value="{{ fila.Car2 }}">
                <button type="submit" class="btn btn-link btn-sm">{{ fila.Estado }} Carpeta {{ fila.Car2 }}</button>
              </form>
            {% else %}
              <form action="{{ url_for('pdf_rotulo_carpeta') }}" method="post" target="_blank">
                <button type="submit" name="consulta" value="{{ fila.id }}" class="btn btn-link btn-sm">Carpeta {{ fila.Car2 }}</button>
              </form>
            {% endif %}
          </td>
          {% if fila.Car2 == 1 and fila.Estado == 'C' %}
            <td style="text-align: center;">
              <form action="{{ url_for('pdf_rotulo_caja') }}" method="post" target="_blank">
                <button type="submit" name="consulta" value="{{ fila.Caja }}" class="btn btn-link btn-sm">Caja {{ fila.Caja }}</button>
              </form>
            </td>
          {% endif %}
        </tr>
        <!-- Fila para mostrar el índice documental (acordeón) -->
        <tr class="panel" style="display: none;">
          <td colspan="11" class="text-end">
            <form action="{{ url_for('pdf_indice') }}" method="post" target="_blank" style="display: inline-block; margin-right: 25px;">
              <input type="hidden" name="Carpeta" value="{{ fila.Car2 }}">
              <button type="submit" name="Caja" value="{{ fila.Caja }}" class="btn btn-sm">Indice Carpeta {{ fila.Car2 }}</button>
            </form>
            <div style="width: 90%; display: flex; justify-content: center; padding-right: 5%;">
              <table class="mi-tabla2">
                {% for row in fila.indice %}
                  <tr>
                    <td style="text-align: left;"><i>{{ row.DescripcionUnidadDocumental }}</i></td>
                    <td style="text-align: center;">{{ row.NoFolioInicio }}</td>
                    <td style="text-align: center;">{{ row.NoFolioFin }}</td>
                    <td style="text-align: center;">{{ row.Soporte }}</td>
                  </tr>
                {% endfor %}
              </table>
            </div>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  function searchTable() {
    const input = document.getElementById('search').value.toLowerCase();
    const rows = document.querySelectorAll('#tableBody tr');
    
    rows.forEach(row => {
      const cells = row.querySelectorAll('td');
      let match = Array.from(cells).some(cell => cell.textContent.toLowerCase().includes(input));
      row.style.display = match ? '' : 'none';
      if (match && row.classList.contains('panel')) {
        const previousRow = row.previousElementSibling;
        if (previousRow) previousRow.style.display = '';
      }
    });
  }

  document.querySelectorAll('.accordion').forEach(button => {
    button.addEventListener('click', function() {
      const panel = this.closest('tr').nextElementSibling;
      panel.style.display = (panel.style.display === 'table-row') ? 'none' : 'table-row';
    });
  });
</script>
